<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matem√°gica - A Jornada da Flu√™ncia (V. 24.8)</title>
    
    <link rel="stylesheet" href="styles.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Open+Dyslexic:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    
    <script type="module" src="app.js" defer></script>
</head>
<body class="tema-escuro">
    
    <div vw class="enabled">
        <div vw-access-button class="active" aria-label="Acessibilidade em Libras"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-row"></div>
        </div>
    </div>
    
    <div id="tela-inicial" class="container"> 
        
        <div class="acessibilidade-bar">
            <button id="btn-toggle-contraste" aria-label="Ativar Alto Contraste">üåó</button>
            <button id="btn-toggle-libras" aria-label="Ativar VLibras">ü§ü</button>
            <button id="btn-toggle-tts" aria-label="Ativar Leitura em Voz (TTS)">üó£Ô∏è</button>
            <button id="btn-toggle-dislexia" aria-label="Ativar Modo Dislexia">üî§</button>
            <button id="btn-zoom-out" aria-label="Diminuir Zoom" style="font-weight: bold; font-size: 1.2em;">-</button>
            <span id="current-zoom" style="font-size: 1em;">100%</span>
            <button id="btn-zoom-in" aria-label="Aumentar Zoom" style="font-weight: bold; font-size: 1.2em;">+</button>
            <button id="btn-config" aria-label="Abrir Configura√ß√µes">‚öôÔ∏è</button>
        </div>
        
        <header class="header">
            <h1 id="app-logo">Matem√°gica</h1>
            <p>A Jornada da Flu√™ncia Matem√°tica</p>
            
            <div id="display-level" aria-live="polite">Mago N√≠vel 1 | XP: 0/500</div>
            
            <div class="xp-barra-container">
                <div id="xp-barra-progresso" class="xp-barra-progresso"></div>
            </div>
        </header>

        <div class="card">
            <h2>1. Escolha a Opera√ß√£o</h2>
            
            <div class="opcoes-container" style="margin-bottom: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button data-operacao="adicao" class="btn-secundario" aria-label="Adi√ß√£o">Adi√ß√£o (+)</button>
                <button data-operacao="subtracao" class="btn-secundario" aria-label="Subtra√ß√£o">Subtra√ß√£o (-)</button>
                <button data-operacao="multiplicacao" class="btn-secundario" aria-label="Multiplica√ß√£o">Multiplica√ß√£o (√ó)</button>
                <button data-operacao="divisao" class="btn-secundario" aria-label="Divis√£o">Divis√£o (√∑)</button>
                <button data-operacao="potenciacao" class="btn-secundario" aria-label="Potencia√ß√£o">Potencia√ß√£o ($$x^y$$)</button>
                <button data-operacao="radiciacao" class="btn-secundario" aria-label="Radicia√ß√£o">Radicia√ß√£o ($\sqrt{x}$)</button>
            </div>
            
            <h2 id="titulo-modo" style="margin-top: 40px;">2. Escolha o N√≠vel e Modo</h2>
            
            <select id="select-nivel" aria-label="Selecione o N√≠vel de Dificuldade" style="width: 100%; margin-bottom: 20px;">
                <option value="facil">F√°cil</option>
                <option value="medio">M√©dio</option>
                <option value="avancado">Avan√ßado</option>
            </select>

            <div class="opcoes-container" style="margin-bottom: 30px;">
                <button id="modo-rapido" class="ativo" data-modo="rapido" aria-label="Modo R√°pido, 10 segundos">Modo R√°pido (10s)</button>
                <button id="modo-normal" data-modo="normal" aria-label="Modo Normal, Sem Tempo">Modo Normal (Sem Tempo)</button>
            </div>

            <button id="btn-iniciar" style="width: 100%;" class="btn-principal" disabled>
                SELECIONE A OPERA√á√ÉO
            </button>
            
            <button id="btn-grimorio" class="btn-secundario" style="width: 100%; margin-top: 20px;" aria-label="Abrir Meu Grim√≥rio (Relat√≥rio de Desempenho)">
                MEU GRIM√ìRIO (RELAT√ìRIO)
            </button>
        </div>
        
        <a id="btn-modo-professor">Acessar Modo Professor</a>
    </div>

    <div id="tela-jogo" class="container" style="position: relative; display: none;">
        <button id="btn-voltar-jogo" class="btn-voltar" aria-label="Voltar para o Menu Inicial">
            üè† Voltar ao In√≠cio
        </button>

        <div class="barra-tempo-container">
            <div id="barra-tempo" class="barra-tempo-progresso"></div>
        </div>

        <div id="contador-combo" class="contador-combo" aria-live="polite">Tokens: 3 | Combo: x1</div>
        
        <div class="card">
            <p id="questao-numero" style="font-size: 1.2em; color: #888; margin-bottom: 15px;">Quest√£o 1</p>
            <div id="questao-texto" class="questao-texto">?</div>
            
            <div id="opcoes-resposta" class="opcoes-resposta">
            </div>
            
            <button id="btn-avancar" style="display: none; margin-top: 30px;" class="btn-principal" aria-label="Avan√ßar para a pr√≥xima quest√£o" tabindex="0">AVAN√áAR (Enter/Espa√ßo)</button>
            <button id="btn-dica" style="margin-top: 15px;" class="btn-secundario" aria-label="Usar Feiti√ßo da Regra">FEITI√áO DA REGRA (Tokens: 3)</button>
        </div>

        <div id="feedback-mentor" class="feedback-box" aria-live="assertive">Aguardando sua resposta, Mago(a)!</div>
    </div>
    
    <div id="tela-grimorio" class="container" style="display: none;">
        <div class="card config-panel">
            <h2>üìú Meu Grim√≥rio M√°gico</h2>
            <p class="grimorio-progress-text">
                Progresso: Mago N√≠vel <span id="grimorio-nivel">1</span> | XP: <span id="grimorio-xp-atual">0</span>/<span id="grimorio-xp-total">500</span>
            </p>
            <p style="margin-top: 10px;">Maior Combo: <span id="grimorio-max-combo">x1</span></p>

            <h3 style="margin-top: 30px; border-bottom: 1px solid var(--cor-secundaria); padding-bottom: 5px;">Distribui√ß√£o de Erros por Opera√ß√£o</h3>
            
            <div class="chart-container" style="margin: 20px auto; max-width: 400px;">
                <canvas id="erros-chart"></canvas>
            </div>
            <p id="grimorio-sem-erros-chart" style="font-size: 0.9em; text-align: center; color: #888;">Nenhum erro registrado para an√°lise gr√°fica.</p>
            
            <h3 style="margin-top: 30px; border-bottom: 1px solid var(--cor-secundaria); padding-bottom: 5px;">Erros Recentes (Foco de Estudo)</h3>
            
            <div id="grimorio-lista-erros">
                <p id="grimorio-sem-erros">Nenhum erro registrado. Voc√™ √© impec√°vel!</p>
                <table id="grimorio-tabela" style="display: none;">
                    <thead>
                        <tr>
                            <th>Quest√£o</th>
                            <th>Opera√ß√£o</th>
                            <th>N√≠vel</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <button id="btn-voltar-grimorio" class="btn-principal" style="margin-top: 40px;">VOLTAR PARA O MENU</button>
        </div>
    </div>

    <div id="tela-config" class="container" style="display: none;">
        <div class="card config-panel">
            <h2>Configura√ß√µes Adicionais</h2>
            
            <div style="text-align: left; margin-top: 25px; line-height: 2.2em;">
                
                <label for="toggle-tema" style="font-size: 1.1em; display: block; margin-bottom: 10px;">Alternar Tema Claro/Escuro:</label>
                <input type="checkbox" id="toggle-tema" role="switch" aria-label="Alternar para Tema Claro">
                
                <p style="margin-top: 20px; color: var(--cor-secundaria);">As demais configura√ß√µes de acessibilidade est√£o dispon√≠veis na tela inicial para acesso r√°pido.</p>
                
            </div>
            
            <button id="btn-voltar-config" class="btn-principal" style="margin-top: 40px;">VOLTAR PARA O MENU</button>
        </div>
    </div>
    
    <div id="modo-professor-container" class="container modo-professor-container" style="display: none;">
        <div class="card">
            <h2>üîí Modo Professor Mago</h2>
            <p style="font-size: 1.1em; color: #888; margin-bottom: 25px;">Ajuste as vari√°veis do jogo e dados dos alunos.</p>
            
            <div style="text-align: left; margin-bottom: 20px;">
                <label for="xp-base-input" style="font-size: 1.1em; display: block; margin-bottom: 8px;">XP Base por Acerto (Padr√£o: 50):</label>
                <input type="number" id="xp-base-input" value="50" min="10" style="width: 100%; padding: 12px; font-size: 1em; border-radius: 8px;">
            </div>
            
            <div style="text-align: left; margin-bottom: 20px;">
                <label for="combo-streak-input" style="font-size: 1.1em; display: block; margin-bottom: 8px;">Acertos para Novo Multiplicador Combo (Padr√£o: 3):</label>
                <input type="number" id="combo-streak-input" value="3" min="1" style="width: 100%; padding: 12px; font-size: 1em; border-radius: 8px;">
            </div>
            
            <h3>Ajuste Fino de N√≠vel (N√∫meros M√°ximos)</h3>
            <p style="font-size: 0.9em; color: #888; margin-bottom: 15px;">Defina os limites num√©ricos para os problemas de Adi√ß√£o/Subtra√ß√£o e Expoente M√°ximo.</p>
            
            <div id="range-settings" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="level-config-box">
                    <label class="level-title level-facil">N√≠vel F√ÅCIL</label>
                    <input type="number" id="range-facil-max" min="1" value="10" placeholder="Max N√∫mero" style="margin-top: 5px; width: calc(100% - 10px);">
                    <input type="number" id="range-facil-expo" min="2" value="2" placeholder="Max Expoente" style="margin-top: 5px; width: calc(100% - 10px);">
                </div>
                <div class="level-config-box">
                    <label class="level-title level-medio">N√≠vel M√âDIO</label>
                    <input type="number" id="range-medio-max" min="10" value="50" placeholder="Max N√∫mero" style="margin-top: 5px; width: calc(100% - 10px);">
                    <input type="number" id="range-medio-expo" min="3" value="3" placeholder="Max Expoente" style="margin-top: 5px; width: calc(100% - 10px);">
                </div>
                <div class="level-config-box">
                    <label class="level-title level-avancado">N√≠vel AVAN√áADO</label>
                    <input type="number" id="range-avancado-max" min="50" value="100" placeholder="Max N√∫mero" style="margin-top: 5px; width: calc(100% - 10px);">
                    <input type="number" id="range-avancado-expo" min="4" value="4" placeholder="Max Expoente" style="margin-top: 5px; width: calc(100% - 10px);">
                </div>
            </div>
            
            <button id="btn-exportar-historico" class="btn-secundario" style="margin-top: 30px;">EXPORTAR HIST√ìRICO (CSV)</button>
            <button id="limpar-erros" class="btn-secundario" style="background-color: var(--cor-secundaria); color: white; margin-top: 20px;">LIMPAR APENAS HIST√ìRICO DE ERROS</button>
            <button id="limpar-historico" class="btn-principal" style="background-color: var(--cor-erro); margin-top: 15px; margin-bottom: 20px;">LIMPAR TUDO (PROGresso & Erros)</button>
            <button id="btn-sair-professor" class="btn-principal">SALVAR E SAIR</button>
        </div>
    </div>

</body>
</html>